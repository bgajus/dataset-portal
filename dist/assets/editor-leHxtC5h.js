import"./includes-C1Ym7nk7.js";import{s as y,M as xe,a as Re,c as Ne,d as Be,b as J,e as X,g as He,K as Ot,f as Me}from"./shared-store-ByScQMD0.js";(()=>{const a=t=>document.getElementById(t);function o(t){return String(t??"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}function l(t){return String(t??"").trim()}function jt(t){return String(t||"").split(",").map(e=>e.trim()).filter(Boolean)}function Ut(t){return(Array.isArray(t)?t:[]).map(e=>String(e||"").trim()).filter(Boolean).join(", ")}function It(t){return new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function F(t){try{return new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return""}}function ot(t){return new URL(window.location.href).searchParams.get(t)}const lt=a("pageTitle"),T=a("titleEditing"),ut=a("startedOnDate"),zt=a("previewBtn"),b=a("submitBtn"),Q=a("saveBtn"),Z=a("saveToast"),_=a("requiredRemaining"),tt=a("lockBanner"),P=a("curRequestPanel"),et=a("curViewHistoryBtn"),ct=a("curHistoryCount"),dt=a("curLatestMsg"),ft=a("curLatestMeta"),p=a("reqHistoryModal"),mt=a("reqHistDatasetTitle"),pt=a("reqHistDatasetDoi"),ht=a("reqHistEmpty"),gt=a("reqHistList"),O=a("curatorReviewBtn"),f=a("curatorDrawer"),j=a("curDrawerStatusChip"),yt=a("curDrawerToggleHistoryBtn"),E=a("curDrawerHistoryWrap"),bt=a("curDrawerHistoryCount"),vt=a("curDrawerLatestMsg"),At=a("curDrawerLatestMeta"),wt=a("curDrawerHistEmpty"),St=a("curDrawerHistList"),$=a("curatorNote"),Wt=a("requestUpdatesBtn"),Vt=a("publishBtn"),U=document.querySelector(".status-chip"),Gt=a("descriptionFields"),Kt=a("subjectsFields"),Yt=a("fundingFields"),Jt=a("relatedFields"),v=a("uploadWithGlobusBtn"),Et=a("uploadRequiredAlert"),I=a("uploadedPanel"),z=a("uploadedFilesList");a("helpBtn")?.addEventListener("click",()=>alert("Help (demo) — link this to docs or a support panel."));const h=a("authors-list"),$t=a("add-author-btn"),A=a("author-modal"),qt=a("modal-title"),Xt=A?.querySelector(".modal-close"),Qt=a("cancelForm"),Zt=a("saveAuthorForm"),te=a("saveAddAnother"),w=a("firstName"),x=a("middleName"),q=a("lastName"),L=a("email"),k=a("orcid"),D=a("affiliationEl")||a("affiliation"),ee=a("metaAccordion");let i=null,m=[],u=[],R=null,Lt=null;function re(){const t=window.DatasetPortal?.getRole?.()||"Submitter";return t==="Curator"||t==="Admin"}function W(){const t=String(ot("curator")||"").trim();return(t==="1"||t.toLowerCase()==="true")&&re()}function rt(){const t=String(i?.status||"").toLowerCase();return t==="published"?!0:t==="in review"?!W():!1}let it=null;function kt(){if(it)return it;if(!_)return null;const t=_.closest(".usa-alert");return t?(t.classList.add("editor-required-alert"),it=t,t):null}function ie(){const t=kt();t&&(t.classList.contains("is-hidden")||(t.classList.add("is-hidden"),window.setTimeout(()=>{t.hidden=!0,t.setAttribute("aria-hidden","true")},220)))}function ne(){const t=kt();t&&(!t.classList.contains("is-hidden")&&t.hidden===!1||(t.hidden=!1,t.removeAttribute("aria-hidden"),t.offsetHeight,t.classList.remove("is-hidden")))}function ae(t){t===0?ie():ne()}function se(){if(!f)return;f.hidden=!1,f.setAttribute("aria-hidden","false"),Dt(),Rt();const t=f.querySelector("[data-cur-drawer-close]")||$;try{t?.focus?.()}catch{}}function nt(){f&&(f.hidden=!0,f.setAttribute("aria-hidden","true"))}function oe(){f&&(f.querySelectorAll("[data-cur-drawer-close]").forEach(t=>{t.addEventListener("click",nt)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&(!f||f.hidden||nt())}),O?.addEventListener("click",()=>{$&&($.value=String(i?.curatorNote||"")),se()}),yt?.addEventListener("click",()=>{const e=!(E?!E.hidden:!1);E&&(E.hidden=!e),yt.setAttribute("aria-expanded",e?"true":"false"),e&&Nt()}))}function Dt(){if(!j||!i)return;const t=String(i.status||"Draft"),e=t.toLowerCase().trim();let r="draft";e==="in review"||e==="in-review"||e==="review"?r="in-review":e==="needs updates"||e==="needs-updates"?r="needs-updates":e==="published"?r="published":e==="draft"&&(r="draft"),j.textContent=t,j.setAttribute("aria-label",`Status: ${t}`),j.setAttribute("data-status",r)}function N(t){return!t||typeof t!="object"||Array.isArray(t.reviewRequests)||(t.reviewRequests=[]),t}function B(t){return Array.isArray(t?.reviewRequests)?t.reviewRequests:[]}function Ct(t){const e=B(t);return e.length?e[0]:null}function le(){if(!p)return;p.hidden=!1,document.body.style.overflow="hidden";const t=p.querySelector("[data-req-close]")||p;try{t?.focus?.()}catch{}}function xt(){p&&(p.hidden=!0,document.body.style.overflow="")}function ue(){p&&(p.querySelectorAll("[data-req-close]").forEach(t=>{t.addEventListener("click",xt)}),document.addEventListener("keydown",t=>{t.key==="Escape"&&p&&p.hidden===!1&&xt()}))}function ce(){if(P)if(!i)P.hidden=!0;else{N(i);const t=B(i),e=Ct(i),r=String(i.status||"").toLowerCase(),n=l(i.curatorNote);if(!(t.length>0||!!n||r==="needs updates"))P.hidden=!0;else{P.hidden=!1,ct&&(ct.textContent=String(t.length||0));const c=e?.message?String(e.message):n||"—";dt&&(dt.textContent=c);const d=e?.createdAt?F(e.createdAt):"",g=d?`Most recent request: ${d}`:n?"Most recent request: (legacy note)":"";ft&&(ft.textContent=g||"—"),et&&(et.hidden=t.length===0)}}if(i){N(i);const t=B(i),e=Ct(i),r=l(i.curatorNote);bt&&(bt.textContent=String(t.length||0));const n=e?.message?String(e.message):r||"—";vt&&(vt.textContent=n);const s=e?.createdAt?F(e.createdAt):"",c=s?`Most recent request: ${s}`:r?"Most recent request: (legacy note)":"";At&&(At.textContent=c||"—"),Rt()}}function de(){if(!i||!gt)return;N(i);const t=B(i);mt&&(mt.textContent=String(i.title||"Untitled Dataset")),pt&&(pt.textContent=String(i.doi||"")),ht&&(ht.hidden=t.length!==0),gt.innerHTML=t.map(e=>{const r=F(e.createdAt);return`
        <article class="req-hist__item">
          <div class="req-hist__top">
            <div class="req-hist__label">
              <i class="fa-solid fa-rotate-left" aria-hidden="true"></i>
              Request updates
            </div>
            <div class="req-hist__when">${o(r)}</div>
          </div>
          <div class="req-hist__msg">${o(e.message||"")}</div>
        </article>
      `}).join("")}function Rt(){E&&(E.hidden||Nt())}function Nt(){if(!i||!St)return;N(i);const t=B(i);wt&&(wt.hidden=t.length!==0),St.innerHTML=t.map(e=>{const r=F(e.createdAt);return`
          <article class="cur-drawer__histItem">
            <div class="cur-drawer__histTop">
              <strong>Request updates</strong>
              <div class="cur-drawer__histWhen">${o(r)}</div>
            </div>
            <div class="cur-drawer__histMsg">${o(e.message||"")}</div>
          </article>
        `}).join("")}function fe(){if(!O)return;const t=String(i?.status||"").toLowerCase(),e=W()&&(t==="in review"||t==="needs updates");O.hidden=!e,O.setAttribute("aria-hidden",e?"false":"true")}function V(t){if(!U)return;const e=t||"Draft",r=String(e).toLowerCase().trim();let n="draft";r==="in review"||r==="in-review"||r==="review"?n="in-review":r==="needs updates"||r==="needs-updates"?n="needs-updates":r==="published"?n="published":r==="draft"&&(n="draft"),U.textContent=e,U.setAttribute("aria-label",`Status: ${e}`),U.setAttribute("data-status",n),Dt()}function G(){const t=rt();if(tt&&(tt.hidden=!t,t)){const r=tt.querySelector(".usa-alert__heading");r&&(r.textContent=i?.status||"In Review")}if(Q&&(Q.disabled=t),b)if(t)b.disabled=!0,b.setAttribute("aria-disabled","true");else{const r=Y().length;b.disabled=r!==0,b.setAttribute("aria-disabled",r!==0?"true":"false")}if(Array.from(document.querySelectorAll("[data-section-content]")).forEach(r=>{Array.from(r.querySelectorAll("input, select, textarea, button")).forEach(s=>{t?(s.disabled=!0,s.setAttribute("aria-disabled","true")):(s.disabled=!1,s.removeAttribute("aria-disabled"))})}),v&&(t?(v.classList.add("is-disabled"),v.setAttribute("aria-disabled","true"),v.setAttribute("tabindex","-1")):(v.classList.remove("is-disabled"),v.removeAttribute("aria-disabled"),v.removeAttribute("tabindex"))),t)try{A?.setAttribute("hidden","")}catch{}fe(),ce()}function me(t){return String(t).replace(/[^a-zA-Z0-9]+/g,"-").replace(/^-+|-+$/g,"")}function pe(t,e){const r=me(t.key),n=t.required?' <span class="required-star" aria-hidden="true">*</span>':"",s=t.required?"required data-required":"",c=t.hint?`<div class="usa-hint">${o(t.hint)}</div>`:"",d=e==="related"?'data-conditional="related"':"";if(t.type==="text")return`
        <div class="usa-form-group">
          <label class="usa-label" for="${r}">${o(t.label)}${n}</label>
          ${c}
          <input
            class="usa-input"
            id="${r}"
            type="text"
            ${s}
            data-path="${o(t.key)}"
            data-section="${o(e)}"
            ${d}
          />
        </div>
      `;if(t.type==="textarea"){const g=Number(t.rows||5);return`
        <div class="usa-form-group">
          <label class="usa-label" for="${r}">${o(t.label)}${n}</label>
          ${c}
          <textarea
            class="usa-textarea"
            id="${r}"
            rows="${g}"
            ${s}
            data-path="${o(t.key)}"
            data-section="${o(e)}"
            ${d}
          ></textarea>
        </div>
      `}if(t.type==="select"){const g=(Array.isArray(t.options)?t.options:[]).map(M=>typeof M=="string"?`<option value="${o(M)}">${o(M)}</option>`:`<option value="${o(M.value)}">${o(M.label)}</option>`).join(""),C=t.placeholder||"Select";return`
        <div class="usa-form-group">
          <label class="usa-label" for="${r}">${o(t.label)}${n}</label>
          ${c}
          <select
            class="usa-select"
            id="${r}"
            ${s}
            data-path="${o(t.key)}"
            data-section="${o(e)}"
            ${d}
          >
            <option value="">${o(C)}</option>
            ${g}
          </select>
        </div>
      `}if(t.type==="multiselect"){const g=(Array.isArray(t.options)?t.options:[]).map(C=>`<option value="${o(C)}">${o(C)}</option>`).join("");return`
        <div class="usa-form-group">
          <label class="usa-label" for="${r}">${o(t.label)} <span class="text-base">(Optional)</span></label>
          ${t.hint?`<div class="usa-hint">${o(t.hint)}</div>`:""}
          <select
            id="${r}"
            class="usa-select"
            multiple
            size="8"
            data-path="${o(t.key)}"
            data-section="${o(e)}"
          >
            ${g}
          </select>
        </div>
      `}if(t.type==="keywords"){const g="keywordsDatalist",C=t.placeholder||"";return`
        <div class="usa-form-group">
          <label class="usa-label" for="${r}">${o(t.label)} <span class="text-base">(Optional)</span></label>
          ${c}
          <input
            id="${r}"
            class="usa-input"
            type="text"
            placeholder="${o(C)}"
            list="${g}"
            data-path="${o(t.key)}"
            data-section="${o(e)}"
          />
          <datalist id="${g}"></datalist>
        </div>
      `}return""}function K(t){const e=X(t);if(!e||e.kind!=="fields")return;const n={description:Gt,subjects:Kt,funding:Yt,related:Jt}[t];if(n&&(n.innerHTML=e.fields.map(s=>pe(s,t)).join(""),t==="related"&&e.conditionalRequired?.note)){const s=document.createElement("div");s.className="usa-hint margin-bottom-2",s.textContent=e.conditionalRequired.note,n.prepend(s)}}function he(){K("description"),K("subjects"),K("funding"),K("related")}function ge(){const t=document.getElementById("keywordsDatalist");if(!t)return;const e=He(),r=new Set((Array.isArray(Ot)?Ot:[]).map(s=>l(s)).filter(Boolean));e.forEach(s=>{(Array.isArray(s.keywords)?s.keywords:[]).forEach(c=>{const d=l(c);d&&r.add(d)})});const n=Array.from(r).sort((s,c)=>s.localeCompare(c));t.innerHTML=n.map(s=>`<option value="${o(s)}"></option>`).join("")}function ye(t){const e=t.getAttribute("data-path");return e?t.tagName==="SELECT"&&t.multiple?Array.from(t.selectedOptions).map(r=>r.value):e==="keywords"?jt(t.value):t.value:null}function be(t,e){const r=t.getAttribute("data-path");if(r){if(t.tagName==="SELECT"&&t.multiple){const n=new Set((Array.isArray(e)?e:[]).map(s=>l(s)).filter(Boolean));Array.from(t.options).forEach(s=>{s.selected=n.has(s.value)});return}if(r==="keywords"){t.value=Ut(e);return}t.value=e??""}}function ve(){Array.from(document.querySelectorAll("[data-path]")).forEach(e=>{e.addEventListener("input",()=>{if(!i||rt())return;const r=e.getAttribute("data-path"),n=ye(e);Me(i,r,n),r==="title"&&(Mt(n),T&&(T.hidden=!1),clearTimeout(Lt),Lt=setTimeout(()=>{T&&(T.hidden=!0)},650)),S()})})}function Ae(){Array.from(document.querySelectorAll("[data-path]")).forEach(e=>{const r=e.getAttribute("data-path"),n=J(i,r);be(e,n)})}function Bt(){return(X("related")?.conditionalRequired?.keys||[]).some(r=>l(J(i,r)))}function Y(){const t=[];return Be().forEach(r=>{if(r.section==="related"||!r.required)return;const n=J(i,r.key);(Array.isArray(n)?n.length===0:!l(n))&&t.push({section:r.section,key:r.key})}),(!Array.isArray(m)||m.length<1)&&t.push({section:"upload",key:"uploadedFiles"}),(!Array.isArray(u)||u.length<1)&&t.push({section:"authors",key:"authors"}),Bt()&&(X("related")?.conditionalRequired?.keys||[]).forEach(s=>{const c=J(i,s);l(c)||t.push({section:"related",key:s})}),t}function we(t,e){const r=document.querySelector(`[data-status-for="${t}"]`);if(!r)return;const n=X(t);if(n?n.required===!1:!1){if(t==="related"&&Bt()&&e>0){r.dataset.state="incomplete",r.textContent=`Missing: ${e}`,r.style.cursor="pointer",r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.setAttribute("aria-label",`Jump to first missing required field in ${t}`);return}r.dataset.state="neutral",r.textContent="Optional",r.style.cursor="default",r.removeAttribute("role"),r.removeAttribute("tabindex"),r.removeAttribute("aria-label");return}e>0?(r.dataset.state="incomplete",r.textContent=`Missing: ${e}`,r.style.cursor="pointer",r.setAttribute("role","button"),r.setAttribute("tabindex","0"),r.setAttribute("aria-label",`Jump to first missing required field in ${t}`)):(r.dataset.state="complete",r.textContent="Complete",r.style.cursor="default",r.removeAttribute("role"),r.removeAttribute("tabindex"),r.removeAttribute("aria-label"))}function S(){const t=Y(),e=t.length;_&&(_.textContent=String(e)),ae(e),b&&(b.disabled=e!==0,b.setAttribute("aria-disabled",e!==0?"true":"false")),xe.forEach(r=>{const n=t.filter(s=>s.section===r.id).length;we(r.id,n)}),Et&&(Et.hidden=Array.isArray(m)&&m.length>0)}function at(t){if(!t)return;const e=document.getElementById("stickyShell")?.getBoundingClientRect().height||0,r=t.getBoundingClientRect().top+window.scrollY-e-16;window.scrollTo({top:r,behavior:"smooth"}),t.focus?.({preventScroll:!0})}function Ht(t){const e=Y().filter(s=>s.section===t);if(Se(t),t==="upload"){at(v);return}if(t==="authors"){at($t);return}const r=e[0];if(!r)return;const n=document.querySelector(`[data-path="${CSS.escape(r.key)}"]`);n&&at(n)}function Se(t){const e=ee?.querySelector(`.usa-accordion__heading[data-section="${t}"]`);if(!e)return;const r=e.querySelector(".usa-accordion__button"),n=r?.getAttribute("aria-controls"),s=n?document.getElementById(n):null;!r||!s||r.getAttribute("aria-expanded")!=="true"&&r.click()}document.addEventListener("click",t=>{const e=t.target;if(!(e instanceof Element))return;const r=e.closest("[data-status-for]");if(!r)return;const n=r.getAttribute("data-status-for");n&&r.dataset.state==="incomplete"&&Ht(n)}),document.addEventListener("keydown",t=>{if(t.key!=="Enter"&&t.key!==" ")return;const e=t.target;if(!(e instanceof Element))return;const r=e.closest("[data-status-for]");if(!r)return;const n=r.getAttribute("data-status-for");n&&r.dataset.state==="incomplete"&&(t.preventDefault(),Ht(n))});function Mt(t){const e=l(t)||"Untitled Dataset";lt&&(lt.textContent=e)}function Ee(){m=[{name:"dataset-files.zip",size:"1.2 GB"},{name:"README.md",size:"4 KB"}],i&&(i.uploadedFiles=m,y(i)),z&&(z.innerHTML=m.map(t=>`<li>${o(t.name)} <span class="text-italic text-base">(${o(t.size)})</span></li>`).join("")),I&&(I.hidden=!1),S()}v?.addEventListener("click",t=>{if(rt()){t.preventDefault();return}setTimeout(Ee,450)});function Ft(t="add"){A&&(A.hidden=!1,A.setAttribute("aria-hidden","false"),qt&&(qt.textContent=t==="edit"?"Edit Author":"Add Author"),setTimeout(()=>w?.focus?.(),0))}function st(){A&&(A.hidden=!0,A.setAttribute("aria-hidden","true"),R=null)}function Tt(){w&&(w.value=""),x&&(x.value=""),q&&(q.value=""),L&&(L.value=""),k&&(k.value=""),D&&(D.value="")}function $e(t){const e=l(t);return e?/^\d{4}-\d{4}-\d{4}-\d{3}[\dX]$/.test(e):!0}function _t(){const t=l(w?.value),e=l(q?.value),r=l(L?.value),n=l(D?.value),s=l(k?.value);return!t||!e||!r||!n?(alert("Please fill all required author fields: First Name, Last Name, Institutional Affiliation, Email."),!1):/^\S+@\S+\.\S+$/.test(r)?$e(s)?!0:(alert("ORCID iD should look like 0000-0000-0000-0000 (last digit may be X). "),!1):(alert("Please enter a valid email address."),!1)}function qe(t){return[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" ")}function H(){if(h){if(h.innerHTML="",u.length===0){const t=document.createElement("li");t.className="text-base text-italic text-secondary",t.textContent="No authors added yet.",h.appendChild(t);return}u.forEach((t,e)=>{const r=document.createElement("li");r.className="author-row",r.draggable=!0,r.dataset.index=String(e);const n=t.email?`<small>${o(t.email)}</small><br>`:"",s=t.orcid?`<small>ORCID: ${o(t.orcid)}</small><br>`:"";r.innerHTML=`
        <span class="drag-handle" title="Drag to reorder" aria-hidden="true">↕</span>
        <div class="author-info">
          <strong>${o(qe(t))}</strong><br>
          ${n}
          ${s}
          <small>${o(t.affiliation||"")}</small>
        </div>
        <div class="author-actions">
          <button type="button" class="usa-button usa-button--unstyled" data-action="edit">Edit</button>
          <button type="button" class="usa-button usa-button--unstyled text-secondary" data-action="delete">Delete</button>
        </div>
      `,r.querySelector('[data-action="edit"]')?.addEventListener("click",()=>{R=e,ke(e),Ft("edit")}),r.querySelector('[data-action="delete"]')?.addEventListener("click",()=>{u.splice(e,1),i.authors=u,y(i),H(),S()}),h.appendChild(r)}),Le()}}function Le(){if(!h)return;let t=null;h.querySelectorAll(".author-row").forEach(e=>{e.addEventListener("dragstart",()=>{t=Number(e.dataset.index),e.classList.add("dragging")}),e.addEventListener("dragover",r=>{r.preventDefault();const n=h.querySelector(".dragging");if(!n)return;const c=[...h.querySelectorAll(".author-row:not(.dragging)")].find(d=>r.clientY<=d.offsetTop+d.offsetHeight/2);h.insertBefore(n,c||null)}),e.addEventListener("drop",()=>{const n=[...h.querySelectorAll(".author-row")].indexOf(e);if(t===null||n<0)return;const s=u.splice(t,1)[0];u.splice(n,0,s),i.authors=u,y(i),H(),S()}),e.addEventListener("dragend",()=>e.classList.remove("dragging"))})}function ke(t){const e=u[t];e&&(w&&(w.value=e.firstName||""),x&&(x.value=e.middleName||""),q&&(q.value=e.lastName||""),L&&(L.value=e.email||""),k&&(k.value=e.orcid||""),D&&(D.value=e.affiliation||""))}function Pt(){return{firstName:l(w?.value),middleName:l(x?.value),lastName:l(q?.value),email:l(L?.value),orcid:l(k?.value),affiliation:l(D?.value)}}$t?.addEventListener("click",()=>{R=null,Tt(),Ft("add")}),Xt?.addEventListener("click",st),Qt?.addEventListener("click",st),Zt?.addEventListener("click",()=>{if(!_t())return;const t=Pt();R==null?u.push(t):u[R]=t,i.authors=u,y(i),H(),st(),S()}),te?.addEventListener("click",()=>{if(!_t())return;const t=Pt();u.push(t),i.authors=u,y(i),H(),Tt(),w?.focus?.(),S()});function De(){Z&&(Z.hidden=!1,setTimeout(()=>Z.hidden=!0,1100))}Q?.addEventListener("click",()=>{i&&(y(i),De())}),zt?.addEventListener("click",()=>{if(!i)return;y(i);const t=i.doi;if(!t)return;const e=`/src/pages/dataset/index.html?doi=${encodeURIComponent(t)}&preview=1`;window.open(e,"_blank","noopener")}),b?.addEventListener("click",()=>{if(i&&!Y().length){if(i.status="In Review",!i.submitterEmail||!i.submitterName){const t=window.DatasetPortal?.getUserProfile?.()||{},e=`${String(t.firstName||"").trim()} ${String(t.lastName||"").trim()}`.trim();i.submitterName=i.submitterName||e,i.submitterEmail=i.submitterEmail||String(t.email||"").trim()}y(i),V(i.status),G();try{window.DatasetPortal?.notifications?.add?.({toRole:"Curator",title:"Dataset submitted for review",message:`${i.title||"A dataset"} was submitted and is ready for curator review.`,href:"/src/pages/curation/index.html",recordDoi:i.doi,kind:"review"})}catch{}}}),Wt?.addEventListener("click",()=>{if(!i||!W())return;const t=String($?.value||"").trim();if(!t){alert("Please enter a curator note before requesting updates."),$?.focus?.();return}N(i);const e={id:`req_${Date.now()}_${Math.random().toString(16).slice(2)}`,type:"request_updates",createdAt:new Date().toISOString(),createdByRole:window.DatasetPortal?.getRole?.()||"Curator",createdByName:"Curator",message:t,flags:[]};i.reviewRequests.unshift(e),i.curatorNote=t,i.status="Needs Updates",y(i),V(i.status),G()}),Vt?.addEventListener("click",()=>{if(!i||!W())return;const t=String($?.value||"").trim();t&&(i.curatorNote=t),i.status="Published",y(i),V(i.status),G(),nt()});function Ce(){he();const t=ot("doi");if(i=t?Re(t):null,i||(i=Ne("Untitled Dataset")),!i.submitterEmail||!i.submitterName){const e=window.DatasetPortal?.getUserProfile?.()||{},r=`${String(e.firstName||"").trim()} ${String(e.lastName||"").trim()}`.trim();i.submitterName=i.submitterName||r,i.submitterEmail=i.submitterEmail||String(e.email||"").trim()}m=Array.isArray(i.uploadedFiles)?i.uploadedFiles:[],u=Array.isArray(i.authors)?i.authors:[],Ae(),ge(),H(),Mt(i.title),V(i.status||"Draft"),ut&&(ut.textContent=It(i.createdAt)),ve(),Array.isArray(m)&&m.length&&(z&&(z.innerHTML=m.map(e=>`<li>${o(e.name||"file")} <span class="text-italic text-base">(${o(e.size||"")})</span></li>`).join("")),I&&(I.hidden=!1)),ue(),et?.addEventListener("click",()=>{de(),le()}),oe(),S(),G()}Ce()})();
