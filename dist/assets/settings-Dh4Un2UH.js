import"./includes-C1Ym7nk7.js";function y(){try{const e=(localStorage.getItem("dp-auth")??"false").toString().toLowerCase();return e==="true"||e==="1"||e==="yes"}catch{return!1}}function A(e){try{return localStorage.setItem("dp-auth",e?"true":"false"),!0}catch(l){return console.warn("Failed to set dp-auth:",l),!1}}function g(){const e=document.getElementById("saveToast");e&&(e.hidden=!1,window.clearTimeout(g._t),g._t=window.setTimeout(()=>{e.hidden=!0},1200))}function a(e){return(e??"").toString()}function D(){const e=document.getElementById("roleSelect"),l=document.getElementById("toggleAuthBtn"),n=document.getElementById("authStateLabel");if(e&&window.DatasetPortal?.getRole){const c=window.DatasetPortal.getRole();e.value=c,e.addEventListener("change",()=>{const o=e.value;window.DatasetPortal?.setRole?window.DatasetPortal.setRole(o):(localStorage.setItem("constellation:role:v1",o),window.location.reload())})}function i(){const c=y();n&&(n.textContent=c?"Signed in":"Signed out")}i(),l&&l.addEventListener("click",()=>{const o=!y();A(o),o?window.location.href="/src/pages/dashboard/index.html":window.location.href="/index.html"})}function N(){const e=window.DatasetPortal?.getUserProfile?window.DatasetPortal.getUserProfile():{},l={firstName:e.firstName,middleName:e.middleName,lastName:e.lastName,email:e.email,affiliation:e.affiliation,orcid:e.orcid};Object.keys(l).forEach(t=>{const r=document.getElementById(t);r&&(r.value=a(l[t]))});const n=document.getElementById("avatarPreviewImg"),i=document.getElementById("avatarPreviewInitials");function c(t){const r=a(t.firstName).trim().slice(0,1).toUpperCase(),m=a(t.lastName).trim().slice(0,1).toUpperCase();return r+m||"??"}function o(t){const r=!!a(t.avatarDataUrl).trim();i&&(i.textContent=c(t)),n&&(r?(n.src=t.avatarDataUrl,n.alt=`${a(t.firstName).trim()} ${a(t.lastName).trim()}`.trim()||"Avatar",n.hidden=!1,i&&(i.hidden=!0)):(n.removeAttribute("src"),n.alt="",n.hidden=!0,i&&(i.hidden=!1)))}o(e);const s=document.getElementById("avatarFile"),v=document.getElementById("removeAvatar"),f=document.getElementById("avatarError");function u(t){f&&(f.textContent=t||"",f.hidden=!t)}function I(t){return new Promise((r,m)=>{const d=new FileReader;d.onerror=()=>m(new Error("Failed to read file")),d.onload=()=>r(String(d.result||"")),d.readAsDataURL(t)})}s&&s.addEventListener("change",async()=>{u("");const t=s.files&&s.files[0];if(!t)return;const r=2*1024*1024;if(t.size>r){u("Please choose an image under 2MB."),s.value="";return}if(!t.type.startsWith("image/")){u("Please choose an image file."),s.value="";return}try{const m=await I(t),d={...e,avatarDataUrl:m};window.DatasetPortal?.saveUserProfile?.(d),Object.assign(e,d),o(e)}catch{u("Could not read that file. Please try a different image.")}finally{s.value=""}}),v&&v.addEventListener("click",()=>{u("");const t={...e,avatarDataUrl:""};window.DatasetPortal?.saveUserProfile?.(t),Object.assign(e,t),o(e)});const w=document.getElementById("saveProfile"),h=document.getElementById("saveProfileBottom");function B(){return{...e,firstName:a(document.getElementById("firstName")?.value).trim(),middleName:a(document.getElementById("middleName")?.value).trim(),lastName:a(document.getElementById("lastName")?.value).trim(),email:a(document.getElementById("email")?.value).trim(),affiliation:a(document.getElementById("affiliation")?.value).trim(),orcid:a(document.getElementById("orcid")?.value).trim()}}function E(){const t=B();window.DatasetPortal?.saveUserProfile?.(t),Object.assign(e,t),o(e),g()}w&&w.addEventListener("click",E),h&&h.addEventListener("click",E)}function P(){D(),N()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P();
