import"./includes-C1Ym7nk7.js";import{g as z}from"./shared-store-ByScQMD0.js";(()=>{const k=document.getElementById("datasetsBody"),A=document.getElementById("emptyState"),E=document.getElementById("searchFilter"),I=document.getElementById("datasetCountChip"),m=document.getElementById("paginationBar"),c=document.getElementById("paginationList"),u=document.getElementById("filterBtn"),l=document.getElementById("filterPopover"),p=document.getElementById("filterBackdrop"),x=document.getElementById("filterCloseBtn"),$=document.getElementById("clearFiltersBtn"),F=document.getElementById("applyFiltersBtn"),h=document.getElementById("statusFilter");let D=[],L="startedOn",f="desc",y="all";const C=10;let d=1,g=[];function B(t){return String(t||"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}function S(t){if(!t)return"—";const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleDateString(void 0,{month:"numeric",day:"numeric",year:"2-digit"})+" "+e.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"})}function T(t){const e=t.toLowerCase();return e==="draft"?"status-draft":e==="in review"?"status-inreview":e==="needs updates"?"status-needsupdates":e==="published"?"status-published":e==="tombstoned"?"status-tombstoned":"status-draft"}function M(t){const e=(t.status||"Draft").toLowerCase(),n=encodeURIComponent(t.doi||"");return e==="published"||e==="tombstoned"?`/src/pages/dataset/index.html?doi=${n}`:`/src/pages/editor/index.html?doi=${n}`}function N(){document.querySelectorAll("#datasetsTable thead th[data-sort]").forEach(t=>{t.removeAttribute("data-sort-state"),t.dataset.sort===L&&t.setAttribute("data-sort-state",f)})}function H(t){if(k.innerHTML="",g.length===0){A.hidden=!1,m&&(m.hidden=!0),I.textContent="0 datasets";return}A.hidden=!0,I.textContent=`${g.length} datasets`,t.forEach(e=>{const n=document.createElement("tr"),i=M(e),s=e.status||"Draft",a=s.toLowerCase(),o=a==="published"||a==="tombstoned",r=o?"fa-eye":"fa-pencil";n.innerHTML=`
        <td>
          <a href="${i}" class="usa-link">${B(e.title||"Untitled")}</a>
        </td>
        <td>${B(e.doi||"—")}</td>
        <td>${S(e.createdAt)}</td>
        <td>${S(e.submittedAt)}</td>
        <td>
          <span class="status-chip ${T(s)}">${B(s)}</span>
        </td>
        <td class="action-icons" aria-label="Actions">
          <a href="${i}" aria-label="${o?"View":"Edit"} dataset">
            <i class="fa-solid ${r}" aria-hidden="true"></i>
          </a>
          <button type="button" aria-label="More actions">
            <i class="fa-solid fa-ellipsis-vertical" aria-hidden="true"></i>
          </button>
        </td>
      `,k.appendChild(n)})}function _({label:t,page:e,current:n=!1,disabled:i=!1,ariaLabel:s,isEllipsis:a=!1}){const o=document.createElement("li");if(o.className="usa-pagination__item",a)return o.className="usa-pagination__item usa-pagination__overflow",o.innerHTML='<span class="usa-pagination__link" aria-hidden="true">…</span>',o;const r=document.createElement("button");return r.type="button",r.className=n?"usa-pagination__button usa-pagination__button--current":"usa-pagination__button",r.textContent=t,s&&r.setAttribute("aria-label",s),n&&r.setAttribute("aria-current","page"),i&&(r.disabled=!0,r.className="usa-pagination__button"),r.addEventListener("click",()=>{i||n||(d=e,v())}),o.appendChild(r),o}function q(t){if(!m||!c)return;if(c.innerHTML="",t<=1){m.hidden=!0;return}m.hidden=!1;const e=5;let n=1,i=Math.min(t,e);d>3&&t>e&&(n=Math.max(1,d-2),i=Math.min(t,n+e-1),i-n+1<e&&(n=Math.max(1,i-e+1)));for(let r=n;r<=i;r+=1)c.appendChild(_({label:String(r),page:r,current:r===d,ariaLabel:`Page ${r}`}));i<t-1&&c.appendChild(_({isEllipsis:!0})),i<t&&c.appendChild(_({label:String(t),page:t,current:t===d,ariaLabel:`Page ${t}`}));const s=document.createElement("li");s.className="usa-pagination__item usa-pagination__arrow";const a=document.createElement("button");a.type="button",a.className="usa-pagination__link usa-pagination__next-page",a.setAttribute("aria-label","Next page"),a.innerHTML='Next <span class="usa-pagination__link-text"><i class="fa-solid fa-chevron-right" aria-hidden="true"></i></span>';const o=d>=t;o&&(a.disabled=!0,a.setAttribute("aria-disabled","true"),a.classList.add("is-disabled")),a.addEventListener("click",()=>{o||(d+=1,v())}),s.appendChild(a),c.appendChild(s)}function v(){const t=Math.max(1,Math.ceil(g.length/C));d>t&&(d=t);const e=(d-1)*C,n=g.slice(e,e+C);H(n),q(t)}function w(){let t=D.slice();y!=="all"&&(t=t.filter(n=>(n.status||"Draft").toLowerCase()===y.toLowerCase()));const e=(E?.value||"").trim().toLowerCase();e&&(t=t.filter(n=>(n.title||"").toLowerCase().includes(e)||(n.doi||"").toLowerCase().includes(e))),t.sort((n,i)=>{let s,a;switch(L){case"title":s=(n.title||"").toLowerCase(),a=(i.title||"").toLowerCase();break;case"doi":s=n.doi||"",a=i.doi||"";break;case"startedOn":s=new Date(n.createdAt||0),a=new Date(i.createdAt||0);break;case"submittedOn":s=new Date(n.submittedAt||0),a=new Date(i.submittedAt||0);break;case"status":s=(n.status||"Draft").toLowerCase(),a=(i.status||"Draft").toLowerCase();break;default:s=new Date(n.createdAt||0),a=new Date(i.createdAt||0)}return s<a?f==="asc"?-1:1:s>a?f==="asc"?1:-1:0}),g=t,N(),d=1,v()}function O(){!l||!p||!u||(l.hidden=!1,p.hidden=!1,u.setAttribute("aria-expanded","true"),h&&(h.value=y),x?.focus())}function b({restoreFocus:t=!0}={}){!l||!p||!u||(l.hidden=!0,p.hidden=!0,u.setAttribute("aria-expanded","false"),t&&u.focus())}function R(){y=h?.value||"all",w(),b()}function U(){h&&(h.value="all")}function V(t){t.key==="Escape"&&l&&!l.hidden&&(t.preventDefault(),b())}D=z(),w(),E?.addEventListener("input",()=>{clearTimeout(E._t),E._t=setTimeout(w,200)}),document.querySelectorAll("#datasetsTable thead th[data-sort]").forEach(t=>{const e=t.querySelector(".md-thBtn");e&&e.addEventListener("click",()=>{const n=t.dataset.sort;L===n?f=f==="asc"?"desc":"asc":(L=n,f="asc"),w()})}),u?.addEventListener("click",()=>{l?.hidden?O():b()}),p?.addEventListener("click",()=>b()),x?.addEventListener("click",()=>b()),F?.addEventListener("click",R),$?.addEventListener("click",()=>{U()}),document.addEventListener("keydown",V)})();
