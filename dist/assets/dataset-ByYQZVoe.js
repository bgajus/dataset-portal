import"./includes-C1Ym7nk7.js";import{a as X,b,D as Z}from"./shared-store-ByScQMD0.js";import{a as tt}from"./demo-datasets-ROcwX3iX.js";(()=>{const r=t=>document.getElementById(t);function f(t){return String(t||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function I(t){if(!t)return"—";const e=new Date(t.includes("T")?t:`${t}T00:00:00`);return Number.isNaN(e.getTime())?"—":e.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric"})}function D(t){if(!t)return"—";try{const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}catch{return"—"}}function N(t){return tt(t)}function x(){const t=new URLSearchParams(window.location.search);return{doi:(t.get("doi")||"").trim(),preview:(t.get("preview")||"").trim()==="1"}}function y(t){return[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" ")}function O(t){const e=r("dsAuthors");if(!e)return;const n=Array.isArray(t.authors)?t.authors:[];if(n.length===0){e.textContent="—";return}const o=n.slice(0,8),s=Math.max(0,n.length-o.length),a=o.map(c=>{const l=y(c)||"Contributor",u=!!(c.orcid||"").trim();return`
          <span class="dlp-author">
            ${f(l)}
            ${u?`<span class="dlp-orcid" title="ORCID: ${f(c.orcid)}" aria-hidden="true">i</span>`:""}
          </span>
        `}).join('<span class="text-base margin-x-05">,</span>'),d=s?`
        <span class="text-base margin-x-05">,</span>
        <a href="#" id="moreContribs" class="dlp-moreLink" aria-label="View all contributors">+${s} others</a>
      `:"";e.innerHTML=`${a}${d}`}function R(t,e){const n=r("contribPopover"),i=r("contribBackdrop"),o=r("popTitle"),s=r("popClose"),a=r("popSearch"),d=r("popMeta"),c=r("popList");if(!n||!i||!o||!s||!a||!d||!c)return;const l=Array.isArray(t.authors)?t.authors:[],u=l.slice();function m(w){const h=(w||"").trim().toLowerCase(),A=h?u.filter(g=>`${y(g)} ${g.affiliation||""}`.toLowerCase().includes(h)):u;d.textContent=`${A.length} of ${u.length} shown`,c.innerHTML=A.map(g=>{const S=y(g)||"Contributor",L=(g.affiliation||"").trim();return`
            <div class="dlp-contribRow" title="${f(S)} — ${f(L)}">
              <div class="nm">${f(S)}</div>
              <div class="aff">${f(L||"—")}</div>
            </div>
          `}).join("")}function p(){n.hidden=!0,n.setAttribute("aria-hidden","true"),i.hidden=!0,document.body.style.overflow="",e&&typeof e.focus=="function"&&e.focus()}o.textContent=`Contributors (${l.length})`,a.value="",m(""),n.hidden=!1,n.setAttribute("aria-hidden","false"),i.hidden=!1,document.body.style.overflow="hidden",s.onclick=p,i.onclick=p,a.oninput=()=>m(a.value),setTimeout(()=>a.focus(),0)}function B(t){const e=String(t||"").trim();if(!e)return"—";const n=Z.find(i=>i.value===e);return n?n.label:e}function j(t){if(Array.isArray(t.subjects)&&t.subjects.length)return t.subjects.map(n=>String(n||"").trim()).filter(Boolean);const e=(t.subjectsKeywords||"").trim();return e?e.split(",").map(n=>n.trim()).filter(Boolean):[]}function E(t){if(Array.isArray(t.keywords)&&t.keywords.length)return t.keywords.map(n=>String(n||"").trim()).filter(Boolean);const e=(t.keywordsCsv||"").trim();return e?e.split(",").map(n=>n.trim()).filter(Boolean):[]}function z(t){const e=r("dsDescription");if(!e)return;const n=String(t.description||"").trim();e.innerHTML=n?`<p>${f(n)}</p>`:"<p>No description available.</p>"}function H(t){const e=r("sectionFunding"),n=r("fundingDl");if(!e||!n)return;const i=[{key:"fundingInfo.doeContractNumber",label:"DOE Contract Number"},{key:"fundingInfo.originatingResearchOrganization",label:"Originating Research Organization"},{key:"fundingInfo.sponsoringOrganizations",label:"Sponsoring Organizations"},{key:"fundingInfo.olcfProjectIdentifier",label:"OLCF Project Identifier"},{key:"fundingInfo.otherContributingOrganizations",label:"Other Contributing Organizations"},{key:"fundingInfo.otherContractNumbers",label:"Other Contract Number(s)"},{key:"fundingInfo.otherIdentifyingNumbers",label:"Other Identifying Numbers"}],o=t.funding?.funderName||"",s=t.funding?.awardNumber||"",a=i.map(c=>{let l=b(t,c.key);return l=String(l||"").trim(),!l&&c.key==="fundingInfo.sponsoringOrganizations"&&(l=String(o||"").trim()),!l&&c.key==="fundingInfo.doeContractNumber"&&(l=String(s||"").trim()),!l&&!["fundingInfo.doeContractNumber","fundingInfo.originatingResearchOrganization","fundingInfo.sponsoringOrganizations"].includes(c.key)?"":`<dt>${f(c.label)}</dt><dd>${f(l||"—")}</dd>`}).filter(Boolean).join("");if(!(!!String(b(t,"fundingInfo.doeContractNumber")||s||"").trim()||!!String(b(t,"fundingInfo.originatingResearchOrganization")||"").trim()||!!String(b(t,"fundingInfo.sponsoringOrganizations")||o||"").trim())){e.hidden=!0,n.innerHTML="";return}e.hidden=!1,n.innerHTML=a}function M(t){const e=t.relatedWork||{},n=String(e.relatedIdentifier||"").trim(),i=String(e.relatedIdentifierType||"").trim(),o=String(e.relationType||"").trim(),s=Array.isArray(t.related)?t.related:[],a=[];n&&a.push({relatedIdentifier:n,relatedIdentifierType:i,relationType:o}),s.forEach(c=>{const l=String(c?.doi||"").trim(),u=String(c?.url||"").trim();l&&a.push({relatedIdentifier:l,relatedIdentifierType:"DOI",relationType:"Related"}),u&&a.push({relatedIdentifier:u,relatedIdentifierType:"URL",relationType:"Related"})});const d=new Set;return a.filter(c=>{const l=`${c.relatedIdentifierType}|${c.relatedIdentifier}|${c.relationType}`;return d.has(l)?!1:(d.add(l),!0)})}function $(t){const e=String(t||"").trim();return/^https?:\/\//i.test(e)}function T(t){const e=String(t||"").trim();return/^10\.\d{4,9}\//.test(e)}function P(t){const e=r("sectionRelated"),n=r("relatedList");if(!e||!n)return;const i=M(t);if(!i.length){e.hidden=!0,n.innerHTML="";return}e.hidden=!1,n.innerHTML=i.map(o=>{const s=String(o.relatedIdentifier||"").trim(),a=String(o.relatedIdentifierType||"").trim(),d=String(o.relationType||"").trim();let c="";(a.toLowerCase()==="doi"||T(s))&&(c=`https://doi.org/${s}`),!c&&$(s)&&(c=s);const l=d?`${d}: `:"",u=c?`<a href="${f(c)}" target="_blank" rel="noopener noreferrer">${f(s)}</a>`:f(s);return`<li>${f(l)}${u}</li>`}).join("")}function U(t){const e=r("dsAck"),n=String(t.ack||"").trim();e&&(e.textContent=n||"—")}function k(t){const e=String(t||"").toLowerCase().trim();return e==="published"?"published":e==="in review"||e==="in-review"||e==="review"?"in-review":e==="needs updates"||e==="needs-updates"?"needs-updates":e==="tombstoned"||e==="tombstone"?"tombstoned":"draft"}function F(t){const e=r("dsStatusChip");if(!e)return;const n=String(t?.status||"Draft").trim()||"Draft",i=k(n);e.textContent=n,e.setAttribute("data-status",i),e.setAttribute("aria-label",`Status: ${n}`),e.hidden=!1}function v(t){return k(t?.status)==="tombstoned"}function _(t){const e=String(t||"").trim();return e?$(e)?e:T(e)?`https://doi.org/${e}`:/^doi\.org\//i.test(e)?`https://${e}`:e:""}function K(t){const e=r("tombstoneBanner");if(!e)return;const n=v(t);e.hidden=!n;const i=r("tombstoneReason"),o=r("tombstoneDate"),s=r("tombstoneReplacement");if(!n)return;const a=t?.tombstone&&typeof t.tombstone=="object"?t.tombstone:{},d=String(a.reason||"").trim(),c=String(a.tombstonedAt||"").trim(),l=_(a.replacementUrl||"");i&&(i.textContent=d||"—"),o&&(o.textContent=c?D(c):"—"),s&&(l&&$(l)?s.innerHTML=`<a href="${f(l)}" target="_blank" rel="noopener noreferrer">${f(l)}</a>`:s.textContent=l||"—");const u=r("downloadWrap"),m=r("downloadBtn"),p=r("tombstoneActionsNote");u&&(u.hidden=!0),m&&(m.disabled=!0),p&&(p.hidden=!1)}function q(t){r("dsDoi").textContent=t.doi||"—",r("dsRelease").textContent=I(t.createdAt||t.updatedAt||""),r("crumbDoi").textContent=t.doi||"—";const e=j(t),n=r("dsCategories");n&&(n.innerHTML=e.map(a=>`<a href="${`/src/pages/search/index.html?subject=${encodeURIComponent(a)}`}">${f(a)}</a>`).join(", ")||"—");const i=E(t),o=r("dsKeywords");o&&(o.innerHTML=i.length?i.map(a=>`<a class="dlp-keywordChip" href="${`/src/pages/search/index.html?keyword=${encodeURIComponent(a)}`}" aria-label="Filter search by keyword ${f(a)}">${f(a)}</a>`).join(""):"—");const s=B(t.datasetType);r("dsType").textContent=s,r("dsSize").textContent=t.datasetSizeLabel||"—",r("dsSoftware").textContent=String(t.softwareNeeded||t.software||"").trim()||"—"}function V(t,e){const n=t.releaseISO||t.createdAt||t.updatedAt,i=n?new Date(n.includes("T")?n:`${n}T00:00:00`).getFullYear():"",o=(Array.isArray(t.authors)?t.authors:[]).slice(0,5).map(c=>{const l=(c.lastName||"").trim(),u=(c.firstName||"").trim(),m=u?`${u[0]}.`:"";return`${l}${l&&m?", ":""}${m}`}).filter(Boolean).join(", "),s=(Array.isArray(t.authors)?t.authors:[]).length>5?", et al.":"",a=t.title||"Untitled Dataset",d=t.doi?`https://doi.org/${t.doi}`:"";if(e==="mla")return`${o}${s}. "${a}." Oak Ridge National Laboratory, ${i||"n.d."}. ${d}.`;if(e==="chicago")return`${o}${s}. "${a}." Oak Ridge National Laboratory, ${i||"n.d."}. ${d}.`;if(e==="bibtex"){const c=`ornl_${String(t.doi||"dataset").split("/").pop()}`,l=(Array.isArray(t.authors)?t.authors:[]).map(u=>{const m=(u.lastName||"").trim(),p=(u.firstName||"").trim(),w=(u.middleName||"").trim(),h=[p,w].filter(Boolean).join(" ").trim();return`${m}, ${h}`.trim()}).filter(Boolean).join(" and ");return[`@dataset{${c},`,`  title        = {${a}},`,`  author       = {${l}},`,`  year         = {${i||""}},`,"  publisher    = {Oak Ridge National Laboratory},",`  doi          = {${t.doi||""}},`,`  url          = {${d}}`,"}"].join(`
`)}return`${o}${s} (${i||"n.d."}). ${a}. Oak Ridge National Laboratory. ${d}.`}async function W(t){try{return await navigator.clipboard.writeText(t),!0}catch{try{const e=document.createElement("textarea");return e.value=t,e.setAttribute("readonly","true"),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),!0}catch{return!1}}}function C(){const t=r("copyToast");t&&(t.hidden=!1,clearTimeout(C._t),C._t=setTimeout(()=>{t.hidden=!0},1400))}function Y(t){const e=r("citeText"),n=r("citeStyle"),i=r("copyCite");function o(){const s=(n?.value||"apa").toLowerCase(),a=V(t,s);return e&&(e.textContent=a),a}n&&n.addEventListener("change",o),i&&i.addEventListener("click",async()=>{const s=o();await W(s)&&C()}),o()}function G(t){const e=r("downloadBtn");e&&e.addEventListener("click",()=>{v(t)||alert("Download via Globus (demo) — integration coming soon.")}),r("starBtn")?.addEventListener("click",i=>{const o=i.currentTarget.querySelector("i");if(o){const s=o.classList.contains("fa-solid");o.classList.toggle("fa-solid",!s),o.classList.toggle("fa-regular",s)}});const n=r("dsAuthors");n&&n.addEventListener("click",i=>{const o=i.target.closest("#moreContribs");o&&(i.preventDefault(),R(t,o))})}function J(t,e){if(e)return!0;if(t?._isDemo)return!1;const n=String(t?.status||"").trim();return!(!n||n==="Published"||n==="Tombstoned")}function Q(){const{doi:t,preview:e}=x();if(!t){r("dsTitle").textContent="No DOI provided",r("crumbDoi").textContent="Invalid";return}let n=X(t);if(n||(n=N(t)),!n){r("dsTitle").textContent="Dataset not found",r("crumbDoi").textContent=t;return}r("dsTitle").textContent=n.title||"Untitled Dataset",document.title=`${n.title||"Dataset"} — Constellation`;const i=r("previewBanner");i&&(i.hidden=!J(n,e)),F(n),K(n),q(n),O(n),z(n),H(n),P(n),U(n),Y(n),G(n)}Q()})();
