import"./includes-C1Ym7nk7.js";import{g as ot}from"./shared-store-ByScQMD0.js";import{D as at,m as rt}from"./demo-datasets-ROcwX3iX.js";(()=>{const be=at,J=["Bioinformatics","Climate","Computational Fluid Dynamics","Cybersecurity","Energy Systems","Environmental Monitoring","Fusion","Geospatial Analytics","HPC Performance","Machine Learning","Materials Science","Nuclear Energy","Remote Sensing","Robotics","Transportation","Urban Sensing"];function we(e){if(Array.isArray(e.subjects)&&e.subjects.length)return e.subjects.map(n=>String(n||"").trim()).filter(Boolean);const t=String(e.subjectsKeywords||"").trim();return t?t.split(",").map(n=>n.trim()).filter(Boolean):[]}function Q(e){if(Array.isArray(e.keywords)&&e.keywords.length)return e.keywords.map(n=>String(n||"").trim()).filter(Boolean);const t=String(e.keywordsCsv||e.keywordsCSV||e.keywordsText||"").trim();return t?t.split(",").map(n=>n.trim()).filter(Boolean):[]}function X(e){const t=we(e);return t.find(o=>J.includes(o))||t[0]||"Unspecified"}let U=ot().filter(e=>{const t=String(e.status||"").toLowerCase().trim();return t==="published"||t==="tombstoned"}).map(e=>{const t=e.createdAt||Date.now();return{...e,id:e.id||e.doi,dateISO:e.dateISO||(e.createdAt?String(e.createdAt).slice(0,10):new Date().toISOString().slice(0,10)),dateLabel:e.dateLabel||new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),subject:X(e),fileType:e.fileType||"Unknown",datasetFiles:e.datasetFiles||{count:0,sizeGB:0},keywords:Q(e),contributors:(e.authors||e.contributors||[]).map(n=>({first:n.first||n.firstName||"",last:n.last||n.lastName||"",affil:n.affil||n.affiliation||""})),landingUrl:e.landingUrl||`/src/pages/dataset/index.html?doi=${encodeURIComponent(e.doi)}`}});const ve=new Set(U.map(e=>e.doi)),Z=Array.from({length:be},(e,t)=>{const n=rt(t),o=n.publishedAt||n.createdAt||Date.now(),a=new Date(o),l=(()=>{const r=String(n.datasetSizeLabel||"").match(/([0-9]+(?:\.[0-9]+)?)/);return r?Number(r[1]):0})();return{...n,id:n.doi,dateISO:String(o).slice(0,10),dateLabel:a.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}),subject:X(n),fileType:n.datasetType||"ND",datasetFiles:{count:Array.isArray(n.uploadedFiles)?n.uploadedFiles.length:0,sizeGB:Number.isFinite(l)?l:0},keywords:Q(n),contributors:(n.authors||[]).map(r=>({first:r.first||r.firstName||"",last:r.last||r.lastName||"",affil:r.affil||r.affiliation||""})),landingUrl:`/src/pages/dataset/index.html?doi=${encodeURIComponent(n.doi)}`}}).filter(e=>!ve.has(e.doi)),C=[...U,...Z];console.log("Search records loaded:",{real:U.length,demo:Z.length,total:C.length});const h=document.getElementById("q"),O=document.getElementById("clearSearch"),ee=document.getElementById("searchGo"),te=document.getElementById("results"),ke=document.getElementById("empty"),ne=document.getElementById("emptyClear"),se=document.getElementById("chips"),H=document.getElementById("meta"),L=document.getElementById("sort"),oe=document.getElementById("moreFiltersBtn"),b=document.getElementById("moreFiltersModal"),B=document.getElementById("modalIncludeTombstoned"),ae=document.getElementById("moreFiltersCancel"),z=document.getElementById("moreFiltersApply"),re=document.getElementById("pagingRow"),k=document.getElementById("perPage"),A=document.getElementById("pager"),G=document.getElementById("pagerList"),Ee=document.getElementById("yearList"),Se=document.getElementById("catList"),ie=document.getElementById("keywordList"),Le=document.getElementById("typeList"),Be=document.getElementById("yearListM"),$e=document.getElementById("catListM"),ce=document.getElementById("keywordListM"),Ie=document.getElementById("typeListM"),M=document.getElementById("openFilters"),j=document.getElementById("filterDrawer"),T=document.getElementById("filterBackdrop"),le=document.getElementById("closeFilters"),de=document.getElementById("clearBtnMobile"),ue=document.getElementById("applyFiltersMobile"),pe=document.getElementById("clearBtn"),w=document.getElementById("popover"),Ce=document.getElementById("popTitle"),Ae=document.getElementById("popClose"),F=document.getElementById("popSearch"),Me=document.getElementById("popMeta"),je=document.getElementById("popList"),Te=document.getElementById("popViewRecord"),V=document.getElementById("backdrop"),s={q:"",years:new Set,subjects:new Set,types:new Set,keywords:new Set,sort:"relevance",includeTombstoned:!1,perPage:10,page:1},x=new Set;let $=[],_=null;const E=e=>`${e.last}, ${e.first}`;function p(e){return String(e).replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function I(){if(!h||!O)return;const e=(h.value||"").trim();O.hidden=e.length===0}function Fe(){const e=new URLSearchParams(window.location.search),t=(e.get("q")||"").trim(),n=e.getAll("year").map(g=>(g||"").trim()).filter(Boolean),o=(e.get("year")||"").trim(),a=n.length?n:o?o.split(",").map(g=>g.trim()).filter(Boolean):[],l=e.getAll("subject").map(g=>(g||"").trim()).filter(Boolean),r=(e.get("category")||"").trim(),i=l.length?l:[];r&&i.push(r);const m=e.getAll("type").map(g=>(g||"").trim()).filter(Boolean),c=(e.get("type")||"").trim(),u=m.length?m:c?c.split(",").map(g=>g.trim()).filter(Boolean):[],d=e.getAll("keyword").map(g=>(g||"").trim()).filter(Boolean),f=(e.get("keyword")||"").trim(),Xe=d.length?d:f?f.split(",").map(g=>g.trim()).filter(Boolean):[],Ze=(e.get("sort")||"").trim(),et=(e.get("perPage")||"").trim(),tt=(e.get("page")||"").trim(),nt=(e.get("tombstoned")||e.get("includeTombstoned")||"").trim(),st=["1","true","yes","on"].includes(nt.toLowerCase());return{q:t,years:a,subjects:i,types:u,keywords:Xe,sort:Ze,includeTombstoned:st,perPage:et,page:tt}}let W=!1;function me(){const{q:e,years:t,subjects:n,types:o,keywords:a,sort:l,includeTombstoned:r,perPage:i,page:m}=Fe();if(s.q="",s.years.clear(),s.subjects.clear(),s.types.clear(),s.keywords.clear(),s.sort="relevance",s.perPage=10,s.page=1,e?(s.q=e,h.value=e):h.value="",(t||[]).forEach(c=>{const u=String(c||"").trim();u&&s.years.add(u)}),(n||[]).forEach(c=>{const u=String(c||"").trim();u&&J.includes(u)&&s.subjects.add(u)}),(o||[]).forEach(c=>{const u=String(c||"").trim();u&&s.types.add(u)}),(a||[]).forEach(c=>{const u=String(c||"").trim();u&&s.keywords.add(u)}),l?(s.sort=l,L&&(L.value=l)):L&&(L.value="relevance"),s.includeTombstoned=!!r,B&&(B.checked=!!r),i){const c=i.toLowerCase();s.perPage=c==="all"?1/0:Number(i),k&&(k.value=c==="all"?"all":String(Number(i)||10))}else s.perPage=10,k&&(k.value="10");if(m){const c=Number(m);Number.isFinite(c)&&c>=1&&(s.page=Math.floor(c))}else s.page=1;I()}function xe(){const e=new URLSearchParams,t=(s.q||"").trim();return t&&e.set("q",t),Array.from(s.years).sort((n,o)=>String(o).localeCompare(String(n))).forEach(n=>e.append("year",n)),Array.from(s.subjects).sort((n,o)=>String(n).localeCompare(String(o))).forEach(n=>e.append("subject",n)),Array.from(s.types).sort((n,o)=>String(n).localeCompare(String(o))).forEach(n=>e.append("type",n)),Array.from(s.keywords).sort((n,o)=>String(n).localeCompare(String(o))).forEach(n=>e.append("keyword",n)),s.sort&&s.sort!=="relevance"&&e.set("sort",s.sort),s.includeTombstoned&&e.set("tombstoned","1"),s.perPage===1/0?e.set("perPage","all"):s.perPage&&s.perPage!==10&&e.set("perPage",String(s.perPage)),s.page&&s.page!==1&&e.set("page",String(s.page)),e}function _e(e="replace"){if(W)return;const n=xe().toString(),o=n?`${window.location.pathname}?${n}`:window.location.pathname;window.location.pathname+window.location.search!==o&&(e==="push"?window.history.pushState({},"",o):window.history.replaceState({},"",o))}function fe(e,t){if(!t)return!0;const n=t.trim().toLowerCase();return[e.title||"",e.doi||"",e.subject||"",e.fileType||"",(e.keywords||[]).join(" "),(e.contributors||[]).slice(0,40).map(E).join(" ")].join(" ").toLowerCase().includes(n)}function K(e,t){const n=new Map;return e.forEach(o=>{const a=t(o)||"Unknown";n.set(a,(n.get(a)||0)+1)}),[...n.entries()].map(([o,a])=>({value:o,count:a}))}function Pe(e,t){const n=new Map;return e.forEach(o=>{(t(o)||[]).forEach(l=>{const r=String(l||"").trim();r&&n.set(r,(n.get(r)||0)+1)})}),[...n.entries()].map(([o,a])=>({value:o,count:a}))}function Ne(e,t,n,o,a){let l=t.slice();a==="yearDesc"?l.sort((r,i)=>Number(i.value)-Number(r.value)):l.sort((r,i)=>r.value.localeCompare(i.value)),e.innerHTML=l.map(({value:r,count:i},m)=>{const c=`${e.id}-${m}-${r}`.replace(/\s+/g,"-"),u=n.has(r)?"checked":"";return`
        <div class="usa-checkbox margin-bottom-1">
          <input class="usa-checkbox__input" id="${p(c)}" type="checkbox" value="${p(r)}" ${u}>
          <label class="usa-checkbox__label" for="${p(c)}">
            ${p(r)} <span class="text-base">(${i})</span>
          </label>
        </div>
      `}).join(""),e.querySelectorAll('input[type="checkbox"]').forEach(r=>{r.addEventListener("change",i=>o(i.target.value,i.target.checked))})}function De(e,t,n){if(!e)return;const o=x.has(t),a=Array.from(e.querySelectorAll(".usa-checkbox")),l=a.length>n;a.forEach((i,m)=>{if(!l){i.classList.remove("facetHidden");return}const c=!o&&m>=n;i.classList.toggle("facetHidden",c)});let r=e.parentElement?.querySelector(`[data-facet-toggle="${t}"]`);if(l)if(r){const i=r.querySelector("button");i&&(i.setAttribute("aria-expanded",o?"true":"false"),i.textContent=o?"See less":"See more")}else{r=document.createElement("div"),r.className="facetToggleWrap",r.setAttribute("data-facet-toggle",t);const i=document.createElement("button");i.type="button",i.className="usa-button usa-button--unstyled facetToggle",i.setAttribute("aria-expanded",o?"true":"false"),i.textContent=o?"See less":"See more",i.addEventListener("click",()=>{x.has(t)?x.delete(t):x.add(t),S()}),r.appendChild(i),e.insertAdjacentElement("afterend",r)}else r&&r.remove()}function v(e,t,n,o,a,l){Ne(e,t,n,o,a);const r=l&&Number(l.limit)||6,i=l&&l.key||e?.id||"facet";De(e,i,r)}function qe(e,t){if(!t)return 0;const n=t.trim().toLowerCase();let o=0;const a=(e.title||"").toLowerCase(),l=(e.doi||"").toLowerCase(),r=(e.subject||"").toLowerCase(),i=(e.fileType||"").toLowerCase(),m=(e.keywords||[]).join(" ").toLowerCase(),c=(e.contributors||[]).slice(0,40).map(E).join(" ").toLowerCase();a.includes(n)&&(o+=20),m.includes(n)&&(o+=12),r.includes(n)&&(o+=8),c.includes(n)&&(o+=6),i.includes(n)&&(o+=3),l.includes(n)&&(o+=2);const u=Number((e.dateISO||e.createdAt||"").slice(0,4));return isNaN(u)||(o+=(u-2018)*.3),o}function Re(){const e=s.q.trim();return C.map(t=>({...t,_score:qe(t,e)})).filter(t=>{const n=(t.status||"").toLowerCase().trim();if(n==="draft"||n==="tombstoned"&&!s.includeTombstoned)return!1;const o=(t.dateISO||t.createdAt||"").slice(0,4);if(s.years.size&&!s.years.has(o)||s.subjects.size&&!s.subjects.has(t.subject||"Unspecified")||s.types.size&&!s.types.has(t.fileType||"Unknown"))return!1;if(s.keywords.size){const a=new Set(Array.from(s.keywords).map(i=>String(i||"").trim().toLowerCase()).filter(Boolean));if(!(t.keywords||[]).map(i=>String(i||"").trim().toLowerCase()).filter(Boolean).some(i=>a.has(i)))return!1}return!!fe(t,e)})}function Ue(e){const t=s.sort,n=e.slice();return n.sort((o,a)=>t==="relevance"?(a._score??0)-(o._score??0):t==="dateDesc"?(a.dateISO||a.createdAt||"").localeCompare(o.dateISO||o.createdAt||""):t==="dateAsc"?(o.dateISO||o.createdAt||"").localeCompare(a.dateISO||a.createdAt||""):t==="titleAsc"?(o.title||"").localeCompare(a.title||""):t==="titleDesc"?(a.title||"").localeCompare(o.title||""):t==="sizeDesc"?(a.datasetFiles?.sizeGB??0)-(o.datasetFiles?.sizeGB??0):t==="sizeAsc"?(o.datasetFiles?.sizeGB??0)-(a.datasetFiles?.sizeGB??0):0),n}function Oe(e){e.querySelectorAll(".filterSection").forEach(t=>{const n=t.querySelector(".filterHeader");n&&n.addEventListener("click",()=>{const o=n.getAttribute("aria-expanded")==="true";n.setAttribute("aria-expanded",String(!o)),t.classList.toggle("is-collapsed",o)})})}function He(){const e=[];s.years.forEach(t=>e.push({key:`year:${t}`,label:`${t}`})),s.subjects.forEach(t=>e.push({key:`subject:${t}`,label:`${t}`})),s.types.forEach(t=>e.push({key:`type:${t}`,label:`${t}`})),s.keywords.forEach(t=>e.push({key:`keyword:${t}`,label:`${t}`})),s.includeTombstoned&&e.push({key:"tombstoned:on",label:"Including tombstoned"}),se.innerHTML=e.length?e.map(t=>`
          <span class="chip">
            ${p(t.label)}
            <button type="button" aria-label="Remove ${p(t.label)}" data-remove="${p(t.key)}">×</button>
          </span>
        `).join(""):'<span class="usa-hint">No filters applied.</span>'}se.addEventListener("click",e=>{const t=e.target.closest("button[data-remove]");if(!t)return;const n=t.getAttribute("data-remove"),[o,a]=n.split(":");o==="year"&&s.years.delete(a),o==="subject"&&s.subjects.delete(a),o==="type"&&s.types.delete(a),o==="keyword"&&s.keywords.delete(a),s.page=1,S(),y({history:"push"})});function ze(e){const t=e.contributors||[],o=t.slice(0,3),a=Math.max(0,t.length-o.length),l=o.map(i=>`<span class="name" title="${p(E(i))}">${p(E(i))}</span>`).join('<span class="sep">,</span> '),r=a?` <span class="sep">,</span>
          <button
            class="morePill"
            type="button"
            data-action="open-pop"
            data-result-id="${p(e.id)}"
            aria-label="View all contributors for ${p(e.title)}"
          >+${a}</button>`:"";return`<div class="contribSummary">${l}${r}</div>`}function P(){return s.perPage===1/0?1/0:Number(s.perPage)}function Ge(e){const t=P();if(t===1/0)return{pageRows:e,totalPages:1,start:1,end:e.length};const n=Math.max(1,Math.ceil(e.length/t));s.page=Math.max(1,Math.min(s.page,n));const o=(s.page-1)*t,a=Math.min(e.length,o+t);return{pageRows:e.slice(o,a),totalPages:n,start:e.length?o+1:0,end:a}}function Ve(e){if(re.hidden=e<=1&&P()!==1/0,P()===1/0){A.hidden=!0,G.innerHTML="",re.hidden=!1;return}if(e<=1){A.hidden=!0,G.innerHTML="";return}A.hidden=!1;const t=s.page,n=[],o=c=>n.push({type:"page",p:c}),a=()=>n.push({type:"ellipsis"}),l=1,r=new Set([1,e]);for(let c=t-l;c<=t+l;c++)c>=1&&c<=e&&r.add(c);const i=[...r].sort((c,u)=>c-u);let m=null;for(const c of i)m!==null&&c-m>1&&a(),o(c),m=c;G.innerHTML=`
      <li class="usa-pagination__item usa-pagination__arrow">
        <a
          class="usa-pagination__link usa-pagination__previous-page"
          href="#"
          aria-label="Previous page"
          data-page="${t-1}"
          ${t===1?'aria-disabled="true" tabindex="-1"':""}
        >
          <span class="usa-pagination__link-text">Previous</span>
        </a>
      </li>

      ${n.map(c=>{if(c.type==="ellipsis")return`
            <li class="usa-pagination__item usa-pagination__overflow" role="presentation">
              <span>…</span>
            </li>
          `;const u=c.p===t;return`
          <li class="usa-pagination__item usa-pagination__page-no">
            <a
              class="usa-pagination__button ${u?"usa-current":""}"
              href="#"
              aria-label="Page ${c.p}"
              ${u?'aria-current="page"':""}
              data-page="${c.p}"
            >${c.p}</a>
          </li>
        `}).join("")}

      <li class="usa-pagination__item usa-pagination__arrow">
        <a
          class="usa-pagination__link usa-pagination__next-page"
          href="#"
          aria-label="Next page"
          data-page="${t+1}"
          ${t===e?'aria-disabled="true" tabindex="-1"':""}
        >
          <span class="usa-pagination__link-text">Next</span>
        </a>
      </li>
    `}A.addEventListener("click",e=>{const t=e.target.closest("a[data-page]");if(!t||(e.preventDefault(),t.getAttribute("aria-disabled")==="true"))return;const n=Number(t.getAttribute("data-page"));Number.isNaN(n)||(s.page=n,y({history:"push"}))});function We(e,t){const n=s.q.trim(),o=P()!==1/0;e.length===0?H.innerHTML=n?`We found <strong>0</strong> records for “${p(n)}”.`:"We found <strong>0</strong> records.":o?H.innerHTML=n?`Showing <strong>${t.start}–${t.end}</strong> of <strong>${e.length}</strong> records for “${p(n)}”.`:`Showing <strong>${t.start}–${t.end}</strong> of <strong>${e.length}</strong> records.`:H.innerHTML=n?`We found <strong>${e.length}</strong> records for “${p(n)}”.`:`We found <strong>${e.length}</strong> records.`,te.innerHTML=t.pageRows.map(a=>`
      <article class="resultCard">
        <div class="resultGrid">
          <div>
            <div class="resultTitleRow">
            <h3 class="resultTitle margin-0">
              <a class="usa-link" href="${p(a.landingUrl)}">${p(a.title||"Untitled")}</a>
            </h3>
            ${String(a.status||"").toLowerCase().trim()==="tombstoned"?'<span class="resultChip" aria-label="Tombstoned dataset"><i class="fa-solid fa-skull" aria-hidden="true"></i> Tombstoned</span>':""}
            </div>
            <div class="resultDoi">${p(a.doi)}</div>
            ${ze(a)}
          </div>

          <div>
            <div class="metaLabel">Subject</div>
            <div class="metaValue">${p(a.subject||"—")}</div>
          </div>

          <div>
            <div class="metaLabel">Dataset Files</div>
            <div class="metaValue">
              ${p(String(a.datasetFiles.count||0))}
              <span class="text-base">(${p(String(a.datasetFiles.sizeGB||0))} GB)</span>
            </div>
          </div>

          <div>
            <div class="metaLabel">Published Date</div>
            <div class="metaValue">${p(a.dateLabel||"—")}</div>
          </div>

          <div class="resultActions">
            <button class="iconBtn" type="button" aria-label="Save record">☆</button>
          </div>
        </div>
      </article>
    `).join(""),ke.hidden=e.length!==0}function S(){const e=C.filter(d=>{const f=(d.status||"").toLowerCase().trim();return!(f==="draft"||f==="tombstoned"&&!s.includeTombstoned)}).filter(d=>fe(d,s.q)),t=K(e,d=>(d.dateISO||d.createdAt||"").slice(0,4)),n=K(e,d=>d.subject||"Unspecified"),o=K(e,d=>d.fileType||"Unknown"),a=Pe(e,d=>d.keywords||[]),l=new Map(a.map(d=>[String(d.value||"").trim().toLowerCase(),d.value])),r=new Set;s.keywords.forEach(d=>{const f=String(d||"").trim().toLowerCase();f&&r.add(l.get(f)||d)}),s.keywords=r,s.keywords.forEach(d=>{a.some(f=>f.value===d)||a.push({value:d,count:0})});const i=(d,f)=>{f?s.years.add(d):s.years.delete(d),s.page=1,y({history:"push"})},m=(d,f)=>{f?s.subjects.add(d):s.subjects.delete(d),s.page=1,y({history:"push"})},c=(d,f)=>{f?s.types.add(d):s.types.delete(d),s.page=1,y({history:"push"})},u=(d,f)=>{f?s.keywords.add(d):s.keywords.delete(d),s.page=1,y({history:"push"})};v(Ee,t,s.years,i,"yearDesc",{limit:6,key:"year-d"}),v(Se,n,s.subjects,m,void 0,{limit:6,key:"subject-d"}),ie&&v(ie,a,s.keywords,u,void 0,{limit:6,key:"keyword-d"}),v(Le,o,s.types,c,void 0,{limit:6,key:"type-d"}),v(Be,t,s.years,i,"yearDesc",{limit:6,key:"year-m"}),v($e,n,s.subjects,m,void 0,{limit:6,key:"subject-m"}),ce&&v(ce,a,s.keywords,u,void 0,{limit:6,key:"keyword-m"}),v(Ie,o,s.types,c,void 0,{limit:6,key:"type-m"})}function ye(e,t){const n=t.trim().toLowerCase(),o=n?e.filter(a=>`${E(a)} ${a.affil||""}`.toLowerCase().includes(n)):e;Me.textContent=`${o.length} of ${e.length} shown`,je.innerHTML=o.map(a=>`
      <div class="contrib-row" title="${p(E(a))} — ${p(a.affil||"")}">
        <div class="nm">${p(E(a))}</div>
        <div class="aff">${p(a.affil||"")}</div>
      </div>
    `).join("")}function Ke(e,t){const n=C.find(m=>m.id===e);if(!n)return;$=n.contributors||[],_=t,Ce.textContent=`Contributors (${$.length})`,Te.href=n.landingUrl,F.value="",ye($,""),w.hidden=!1,w.setAttribute("aria-hidden","false"),V.hidden=!1;const o=t.getBoundingClientRect(),a=10,l=w.getBoundingClientRect();let r=Math.min(o.bottom+8,window.innerHeight-l.height-a);r=Math.max(a,r);let i=Math.min(o.left,window.innerWidth-l.width-a);i=Math.max(a,i),w.style.top=`${r}px`,w.style.left=`${i}px`,setTimeout(()=>F.focus(),0)}function N(){w.hidden=!0,w.setAttribute("aria-hidden","true"),V.hidden=!0,$=[],_&&typeof _.focus=="function"&&_.focus()}let D=null;function Ye(){D=document.activeElement,j.hidden=!1,T.hidden=!1,M.setAttribute("aria-expanded","true"),document.body.style.overflow="hidden",setTimeout(()=>{const e=j.querySelector("button, input, select, a");e&&e.focus()},0)}function q(){j.hidden=!0,T.hidden=!0,M.setAttribute("aria-expanded","false"),document.body.style.overflow="",D&&typeof D.focus=="function"&&D.focus()}function y(e={}){const t=Ue(Re()),n=Ge(t);We(t,n),He(),Ve(n.totalPages),w.hidden||N(),_e(e.history||"replace")}function Y(){s.q="",s.years.clear(),s.subjects.clear(),s.types.clear(),s.keywords.clear(),s.page=1,h.value="",I(),S(),y({history:"push"})}let ge=null;h.addEventListener("input",()=>{clearTimeout(ge);const e=h.value||"";I(),ge=setTimeout(()=>{s.q=e,s.page=1,S(),y()},140)}),O.addEventListener("click",()=>{h.value="",s.q="",s.page=1,I(),S(),y({history:"push"}),h.focus()}),ee&&ee.addEventListener("click",()=>{h&&h.focus()}),L.addEventListener("change",()=>{s.sort=L.value,s.page=1,y({history:"push"})});function Je(){if(!b)return;B&&(B.checked=!!s.includeTombstoned),b.hidden=!1,document.body.style.overflow="hidden";const e=b.querySelector("[data-modal-close]")||z||b;try{e?.focus?.()}catch{}}function R(){b&&(b.hidden=!0,document.body.style.overflow="")}oe&&oe.addEventListener("click",Je),b&&(b.querySelectorAll("[data-modal-close]").forEach(e=>{e.addEventListener("click",R)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(!b||b.hidden||R())})),ae&&ae.addEventListener("click",R),z&&z.addEventListener("click",()=>{const e=!!(B&&B.checked);s.includeTombstoned=e,s.page=1,R(),y({history:"push"})}),k.addEventListener("change",()=>{const e=k.value;s.perPage=e==="all"?1/0:Number(e),s.page=1,y({history:"push"})}),pe&&pe.addEventListener("click",Y),ne&&ne.addEventListener("click",Y),M&&M.addEventListener("click",Ye),le&&le.addEventListener("click",q),T&&T.addEventListener("click",q),de&&de.addEventListener("click",Y),ue&&ue.addEventListener("click",q),te.addEventListener("click",e=>{const t=e.target.closest('button[data-action="open-pop"]');t&&Ke(t.getAttribute("data-result-id"),t)}),Ae.addEventListener("click",N),V.addEventListener("click",N),F.addEventListener("input",()=>{$.length&&ye($,F.value)}),document.addEventListener("keydown",e=>{if(e.key==="Escape"){if(!w.hidden){N();return}if(!j.hidden){q();return}}});function he(){const e=(t,n)=>{const o=document.getElementById(t);o&&o.querySelectorAll('input[type="checkbox"]').forEach(a=>{a.checked=n.has(a.value)})};e("yearList",s.years),e("catList",s.subjects),e("keywordList",s.keywords),e("typeList",s.types),e("yearListM",s.years),e("catListM",s.subjects),e("keywordListM",s.keywords),e("typeListM",s.types)}function Qe(){h.value="",s.q="",I(),k.value="10",s.perPage=10,me(),window.addEventListener("popstate",()=>{W=!0,me(),S(),he(),y(),W=!1}),Oe(document),S(),he(),y()}Qe()})();
