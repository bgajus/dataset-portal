import"./includes-C1Ym7nk7.js";import{c as P,g as y}from"./shared-store-ByScQMD0.js";(()=>{const i=e=>document.getElementById(e),t={note:i("dashNote"),noteClose:i("dashNoteClose"),noteText:i("dashNoteText"),unreadCount:i("dashUnreadCount"),noteLink:i("dashNoteLink"),openModal:i("openDoiModal"),backdrop:i("doiBackdrop"),modal:i("doiModal"),closeModal:i("closeDoiModal"),cancelModal:i("cancelDoiBtn"),stepForm:i("doiStepForm"),stepSuccess:i("doiStepSuccess"),titleInput:i("doiTitle"),reserveBtn:i("reserveDoiBtn"),err:i("doiError"),olcfYes:i("doiOlcfYes"),olcfNo:i("doiOlcfNo"),reservedValue:i("reservedDoiValue"),editLink:i("editRecordLink"),returnBtn:i("returnToDashBtn"),statDatasets:i("statDatasets"),statViews:i("statViews"),statDownloads:i("statDownloads"),statSaved:i("statSaved"),statUploads:i("statUploads"),activityEmpty:i("dashActivityEmpty"),activityList:i("dashActivity"),dashAvatar:i("dashAvatar"),dashAvatarImg:i("dashAvatarImg"),dashAvatarInitials:i("dashAvatarInitials"),dashUserName:i("dashUserName")};function l(){const e=window.DatasetPortal?.getRole?.()||"Submitter",a=window.DatasetPortal?.getUserProfile?.()||{},s=String(a.email||"").trim().toLowerCase(),n=s?`:${s}`:"";return`constellation:dashNoteDismissed:v1:${e}${n}`}function b(){try{const e=localStorage.getItem(l()),a=e?JSON.parse(e):null;return!a||typeof a!="object"?{dismissed:!1,dismissedAtCount:0}:{dismissed:!!a.dismissed,dismissedAtCount:Number(a.dismissedAtCount||0)}}catch{return{dismissed:!1,dismissedAtCount:0}}}function w(e){try{localStorage.setItem(l(),JSON.stringify(e||{}))}catch{}}function u(){try{if(window.DatasetPortal?.notifications?.unreadCount)return Number(window.DatasetPortal.notifications.unreadCount()||0);const e=window.DatasetPortal?.notifications?.listForMe?.()||[];return(Array.isArray(e)?e:[]).filter(a=>a&&a.read===!1).length}catch{return 0}}function A(e,a,s){return e===1?a:s}function C(){if(!t.note)return;const e=u();if(t.unreadCount&&(t.unreadCount.textContent=String(e)),t.noteText){const n=A(e,"notification","notifications");t.noteText.textContent=`You have ${e} unread ${n}.`}t.noteLink&&(t.noteLink.href="/src/pages/notifications/index.html");const a=b(),s=e>0&&(!a.dismissed||e>Number(a.dismissedAtCount||0));t.note.hidden=!s}t.noteClose&&t.note&&t.noteClose.addEventListener("click",()=>{const e=u();w({dismissed:!0,dismissedAtCount:e}),t.note.hidden=!0});function D(){try{const e=window.DatasetPortal?.getUserProfile?.();if(!e)return;const a=String(e.firstName||"").trim(),s=String(e.lastName||"").trim(),n=`${a?a[0].toUpperCase():""}${s?s[0].toUpperCase():""}`||"??";!!String(e.avatarDataUrl||"").trim()&&t.dashAvatarImg?(t.dashAvatarImg.src=e.avatarDataUrl,t.dashAvatarImg.alt=`${a} ${s}`.trim()||"User avatar",t.dashAvatarImg.hidden=!1,t.dashAvatarInitials&&(t.dashAvatarInitials.hidden=!0)):(t.dashAvatarImg&&(t.dashAvatarImg.removeAttribute("src"),t.dashAvatarImg.alt="",t.dashAvatarImg.hidden=!0),t.dashAvatarInitials&&(t.dashAvatarInitials.textContent=n,t.dashAvatarInitials.hidden=!1)),t.dashUserName&&(t.dashUserName.textContent=a||"there")}catch{}}function r(e){return String(e).replace(/[&<>"']/g,a=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[a])}function S(e){return new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function I(e){const a=(e||"").toLowerCase().trim();return a==="draft"?"dash-badge--draft":a==="in review"||a==="review"||a==="in-review"?"dash-badge--review":a==="needs updates"||a==="needs-updates"?"dash-badge--needs":a==="published"?"dash-badge--published":a==="tombstoned"?"dash-badge--tombstoned":"dash-badge--draft"}function f(e){return e==="Draft"?"Draft":e==="In Review"?"In Review":e==="Needs Updates"?"Needs Updates":e==="Published"?"Published":e==="Tombstoned"?"Tombstoned":e||"Draft"}function m(e){return Array.from(e.querySelectorAll("a[href]:not([disabled]), button:not([disabled]), input:not([disabled]), textarea:not([disabled]), select:not([disabled])"))}function h(e){if(e.key!=="Tab")return;const a=m(t.modal);if(a.length===0)return;const s=a[0],n=a[a.length-1];e.shiftKey?(document.activeElement===s||!t.modal.contains(document.activeElement))&&(e.preventDefault(),n.focus()):(document.activeElement===n||!t.modal.contains(document.activeElement))&&(e.preventDefault(),s.focus())}function k(){t.modal.addEventListener("keydown",h),[document.querySelector("header"),document.querySelector("main"),document.querySelector('[data-include="portal-footer"]')].filter(Boolean).forEach(s=>{s&&!s.contains(t.modal)&&(s.setAttribute("aria-hidden","true"),s.setAttribute("inert",""))});const a=m(t.modal)[0];a&&a.focus()}function L(){t.modal.removeEventListener("keydown",h),document.querySelectorAll('[aria-hidden="true"][inert]').forEach(e=>{e.removeAttribute("aria-hidden"),e.removeAttribute("inert")})}function E(){!t.modal||!t.backdrop||(t.stepForm&&(t.stepForm.hidden=!1),t.stepSuccess&&(t.stepSuccess.hidden=!0),t.err&&(t.err.hidden=!0,t.err.textContent=""),t.titleInput&&(t.titleInput.value=""),t.olcfYes&&(t.olcfYes.checked=!1),t.olcfNo&&(t.olcfNo.checked=!1),t.backdrop.hidden=!1,t.modal.hidden=!1,document.body.style.overflow="hidden",k(),setTimeout(()=>t.titleInput?.focus?.(),0))}function o(){!t.modal||!t.backdrop||(t.backdrop.hidden=!0,t.modal.hidden=!0,document.body.style.overflow="",L(),t.openModal?.focus?.())}function N(){const e=(t.titleInput?.value||"").trim();if(!e){t.err&&(t.err.hidden=!1,t.err.textContent="Please enter a dataset title to reserve a DOI."),t.titleInput?.focus?.();return}const a=P(e);t.reservedValue&&(t.reservedValue.textContent=a.doi),t.editLink&&(t.editLink.href=`/src/pages/editor/index.html?doi=${encodeURIComponent(a.doi)}`),t.stepForm&&(t.stepForm.hidden=!0),t.stepSuccess&&(t.stepSuccess.hidden=!1),p(),v()}function v(){const e=y();t.statDatasets&&(t.statDatasets.textContent=String(e.length||0)),t.statViews&&(t.statViews.textContent="774"),t.statDownloads&&(t.statDownloads.textContent="56"),t.statSaved&&(t.statSaved.textContent="14"),t.statUploads&&(t.statUploads.textContent="32 GB")}function p(){if(!t.activityList||!t.activityEmpty)return;const e=y();if(!e.length){t.activityEmpty.hidden=!1,t.activityList.hidden=!0,t.activityList.innerHTML="";return}t.activityEmpty.hidden=!0,t.activityList.hidden=!1;const a=e.slice(0,6).map(s=>{const n=String(s.status||"").toLowerCase().trim(),d=`/src/pages/dataset/index.html?doi=${encodeURIComponent(s.doi)}`,g=`/src/pages/editor/index.html?doi=${encodeURIComponent(s.doi)}`,c=n==="published"||n==="tombstoned",U=c?d:g,x=`${f(s.status)} · ${S(s.updatedAt||s.createdAt)}`,$=I(s.status),T=f(s.status),M=c?d:g,B=c?"View":"Edit";return`
        <div class="dash-activity__row">
          <div>
            <h3 class="dash-activity__title margin-0">
              <a class="usa-link" href="${U}">${r(s.title||"Untitled dataset")}</a>
            </h3>
            <div class="dash-activity__meta">${r(s.doi)} · ${r(x)}</div>
          </div>

          <div class="dash-activity__right">
            <span class="dash-badge ${$}">${r(T)}</span>
            <a class="dash-editlink" href="${M}">${B}</a>
          </div>
        </div>
      `}).join("");t.activityList.innerHTML=a}t.openModal?.addEventListener("click",E),t.closeModal?.addEventListener("click",o),t.cancelModal?.addEventListener("click",o),t.backdrop?.addEventListener("click",o),t.reserveBtn?.addEventListener("click",N),t.returnBtn?.addEventListener("click",o),document.addEventListener("keydown",e=>{e.key==="Escape"&&t.modal&&!t.modal.hidden&&o()}),D(),v(),p(),C(),t.backdrop&&(t.backdrop.hidden=!0),t.modal&&(t.modal.hidden=!0)})();
